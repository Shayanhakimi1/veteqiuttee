import{r as o,j as e,u as B,d as O,a as $,l as M}from"./index-BgTIe4Qm.js";import{B as A}from"./Button-CFZU5Yrt.js";import"./InputField-y3Sg7NNn.js";import{P as E}from"./ProgressBar-DdTIvPjk.js";import{A as z}from"./Alert-COEKwUaA.js";const U=({onFileSelect:d,acceptedTypes:p=["image/*"],maxSize:f=5*1024*1024,multiple:x=!1,className:g="",label:u="فایل های خود را آپلود کنید",description:y="حداکثر اندازه فایل: 5MB"})=>{const[v,h]=o.useState(!1),[n,c]=o.useState([]),[j,b]=o.useState({}),i=o.useRef(null),N=a=>p.some(t=>t==="image/*"?a.type.startsWith("image/"):t==="video/*"?a.type.startsWith("video/"):a.type===t||a.name.toLowerCase().endsWith(t.replace("*",""))),w=a=>a.size<=f,D=a=>{if(a===0)return"0 Bytes";const t=1024,s=["Bytes","KB","MB","GB"],l=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,l)).toFixed(2))+" "+s[l]},S=a=>{const t=Array.from(a),s=[],l=[];if(t.forEach(r=>{if(!N(r)){l.push(`${r.name}: نوع فایل مجاز نیست`);return}if(!w(r)){l.push(`${r.name}: اندازه فایل بیش از حد مجاز است`);return}s.push(r)}),l.length>0&&alert(l.join(`
`)),s.length>0){if(!x)c([s[0]]),d&&d(s[0]);else{const r=[...n,...s];c(r),d&&d(r)}s.forEach(r=>{C(r)})}},C=a=>{const t=a.name;let s=0;const l=setInterval(()=>{s+=Math.random()*30,s>=100&&(s=100,clearInterval(l),setTimeout(()=>{b(r=>{const m={...r};return delete m[t],m})},1e3)),b(r=>({...r,[t]:Math.min(s,100)}))},200)},P=a=>{a.preventDefault(),h(!0)},L=a=>{a.preventDefault(),h(!1)},T=a=>{a.preventDefault(),h(!1);const t=a.dataTransfer.files;S(t)},R=a=>{const t=a.target.files;S(t)},I=a=>{const t=n.filter((s,l)=>l!==a);c(t),d&&d(x?t:null)},F=(a,t)=>{const s=a.type.startsWith("image/"),l=a.type.startsWith("video/"),r=j[a.name];return e.jsx("div",{className:"relative bg-gray-50 rounded-lg p-3 border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-shrink-0",children:s?e.jsx("img",{src:URL.createObjectURL(a),alt:a.name,className:"w-12 h-12 object-cover rounded"}):l?e.jsx("video",{src:URL.createObjectURL(a),className:"w-12 h-12 object-cover rounded"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded flex items-center justify-center",children:e.jsx("svg",{className:"w-6 h-6 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z",clipRule:"evenodd"})})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.name}),e.jsx("p",{className:"text-xs text-gray-500",children:D(a.size)}),r!==void 0&&e.jsxs("div",{className:"mt-1",children:[e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1",children:e.jsx("div",{className:"bg-primary-500 h-1 rounded-full transition-all duration-300",style:{width:`${r}%`}})}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[Math.round(r),"%"]})]})]}),e.jsx("button",{type:"button",onClick:()=>I(t),className:"flex-shrink-0 text-red-500 hover:text-red-700 transition-colors",children:e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})},t)};return e.jsxs("div",{className:`w-full ${g}`,children:[e.jsxs("div",{className:`
          border-2 border-dashed rounded-xl p-6 text-center transition-all duration-300 cursor-pointer
          ${v?"border-cyan-500 bg-cyan-50":"border-gray-300 hover:border-cyan-400 hover:bg-gray-50"}
        `,onDragOver:P,onDragLeave:L,onDrop:T,onClick:()=>{var a;return(a=i.current)==null?void 0:a.click()},children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400 mb-4",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsx("p",{className:"text-lg font-medium text-gray-700 mb-2",children:u}),e.jsx("p",{className:"text-sm text-gray-500",children:y}),e.jsx("input",{ref:i,type:"file",multiple:x,accept:p.join(","),onChange:R,className:"hidden"})]}),n.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"فایل‌های انتخاب شده:"}),n.map((a,t)=>F(a,t))]})]})},H=({type:d="success",title:p,message:f,duration:x=5e3,onClose:g,show:u=!1,position:y="top-right"})=>{const[v,h]=o.useState(u),[n,c]=o.useState(!1),j=o.useCallback(()=>{c(!1),setTimeout(()=>{h(!1),g&&g()},300)},[g]);if(o.useEffect(()=>{if(u&&(h(!0),c(!0),x>0)){const i=setTimeout(()=>{j()},x);return()=>clearTimeout(i)}},[u,x,j]),!v)return null;const b=()=>{switch(y){case"top-left":return"top-4 left-4";case"top-center":return"top-4 left-1/2 transform -translate-x-1/2";case"top-right":return"top-4 right-4";case"bottom-left":return"bottom-4 left-4";case"bottom-center":return"bottom-4 left-1/2 transform -translate-x-1/2";case"bottom-right":return"bottom-4 right-4";default:return"top-4 right-4"}};return e.jsx("div",{className:`fixed z-50 max-w-sm w-full transition-all duration-300 ${b()} ${n?"opacity-100 transform translate-y-0":"opacity-0 transform -translate-y-2"}`,children:e.jsx(z,{type:d,title:p,message:f,onClose:j,className:"shadow-lg"})})},_=()=>{const d=B(),p=O(),{consultationData:f,savePaymentData:x,clearConsultationData:g}=$(),[u,y]=o.useState(!1),[v,h]=o.useState(!1),[n,c]=o.useState({}),[j,b]=o.useState(!1),[i,N]=o.useState({paymentReceipt:[],selectedDate:"",selectedTime:"",confirmPhone:!1}),w="6037-9976-1234-5678",D=28e4,S=()=>{const t=[],s=new Date;for(let l=1;l<=21;l++){const r=new Date(s);r.setDate(s.getDate()+l);const m=r.getDay();if(m===0||m===2||m===4){const k=r.toLocaleDateString("fa-IR",{weekday:"long",year:"numeric",month:"long",day:"numeric"});if(t.push({id:r.toISOString().split("T")[0],display:k,date:r}),t.length>=9)break}}return t},C=()=>{const t=[];for(let r=17;r<=21;r++)for(let m=0;m<60&&!(r===21&&m>0);m+=30){const k=`${r.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")}`;t.push({id:k,display:k,available:Math.random()>.2})}return t},P=S(),L=C();o.useEffect(()=>{f||p.state||d("/consultation")},[f,p.state,d]),o.useEffect(()=>{const t=setInterval(()=>{Object.keys(i).some(s=>i[s]!=="")&&localStorage.setItem("paymentFormData",JSON.stringify(i))},5e3);return()=>clearInterval(t)},[i]);const T=async()=>{try{await navigator.clipboard.writeText(w),b(!0),setTimeout(()=>b(!1),2e3)}catch(t){M.error("Copy to clipboard failed",{error:t})}},R=t=>{N(s=>({...s,selectedDate:t})),n.selectedDate&&c(s=>({...s,selectedDate:""}))},I=t=>{N(s=>({...s,selectedTime:t})),n.selectedTime&&c(s=>({...s,selectedTime:""}))},F=t=>{N(s=>({...s,confirmPhone:t.target.checked})),n.confirmPhone&&c(s=>({...s,confirmPhone:""}))},a=async t=>{t.preventDefault(),y(!0),c({});try{const s={};if(i.selectedDate||(s.selectedDate="انتخاب تاریخ الزامی است"),i.selectedTime||(s.selectedTime="انتخاب زمان الزامی است"),i.confirmPhone||(s.confirmPhone="تأیید شماره تماس الزامی است"),i.paymentReceipt.length===0&&(s.paymentReceipt="بارگذاری رسید پرداخت الزامی است"),Object.keys(s).length>0){c(s),y(!1);return}const l={...f,...i,amount:D,paymentDate:new Date().toISOString(),status:"pending"};await x(l),g(),h(!0),setTimeout(()=>{d("/dashboard")},3e3)}catch(s){M.error("Payment registration failed",{error:s}),c({submit:"خطا در ثبت پرداخت. لطفاً دوباره تلاش کنید."})}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen gradient-bg",children:[e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsx(E,{currentStep:4,totalSteps:4})})})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsx("div",{className:"text-center mb-6",children:e.jsxs("div",{className:"text-white px-6 py-3 rounded-xl inline-block bg-gradient-to-r from-cyan-500 to-teal-500",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:"💳"}),e.jsx("span",{className:"text-sm font-medium",children:"پرداخت هزینه مشاوره"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"هزینه مشاوره:"}),e.jsxs("span",{className:"text-lg font-bold mr-2",children:[D.toLocaleString()," تومان"]})]})]})}),e.jsx("div",{className:"text-center mb-6",children:e.jsxs("div",{className:"text-white px-6 py-3 rounded-xl inline-block bg-gradient-to-r from-cyan-500 to-teal-500",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:"💳"}),e.jsx("span",{className:"text-sm font-medium",children:"شماره کارت:"})]}),e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"font-mono text-lg font-bold",children:w}),e.jsx("button",{type:"button",onClick:T,className:"text-white/80 hover:text-white text-sm",children:"کپی"})]}),j&&e.jsx("p",{className:"text-white/90 text-xs mt-1",children:"شماره کارت کپی شد"})]})}),e.jsxs("form",{onSubmit:a,className:"bg-white rounded-2xl shadow-lg p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"بارگذاری رسید پرداخت"}),e.jsx(U,{files:i.paymentReceipt,onChange:t=>N({...i,paymentReceipt:t}),accept:"image/*",maxFiles:3,label:"رسید پرداخت را بارگذاری کنید"}),n.paymentReceipt&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:n.paymentReceipt})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"تاریخ مشاوره"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:P.map(t=>e.jsx("button",{type:"button",onClick:()=>R(t.id),className:`p-3 rounded-xl border transition-all ${i.selectedDate===t.id?"border-cyan-500 bg-cyan-50 text-cyan-700":"border-gray-200 hover:border-gray-300"}`,children:t.display},t.id))}),n.selectedDate&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:n.selectedDate})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 mb-2",children:"ساعت مشاوره"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-3",children:L.map(t=>e.jsx("button",{type:"button",onClick:()=>I(t.id),disabled:!t.available,className:`p-2 rounded-xl border transition-all ${i.selectedTime===t.id?"border-cyan-500 bg-cyan-50 text-cyan-700":"border-gray-200 hover:border-gray-300"} ${t.available?"":"opacity-50 cursor-not-allowed"}`,children:t.display},t.id))}),n.selectedTime&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:n.selectedTime})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"confirmPhone",checked:i.confirmPhone,onChange:F,className:"mr-2"}),e.jsx("label",{htmlFor:"confirmPhone",className:"text-gray-700",children:"تایید می‌کنم شماره تلفن ثبت‌شده صحیح است"})]}),n.confirmPhone&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:n.confirmPhone}),e.jsxs("div",{children:[e.jsx(A,{type:"submit",disabled:u,className:"w-full",children:u?"در حال هدایت به پرداخت...":"تایید و ادامه"}),n.submit&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:n.submit})]})]}),v&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-4 py-2 rounded-full shadow-lg",children:"اطلاعات شما ذخیره شد"})]}),e.jsx("div",{className:"py-6 text-center text-white opacity-80",children:e.jsx("p",{className:"text-sm",children:"بیمارستان دامپزشکی دکتر فتاحیان"})}),v&&e.jsx(H,{type:"success",message:"پرداخت با موفقیت ثبت شد. در حال هدایت به داشبورد...",onClose:()=>h(!1)})]})};export{_ as default};
