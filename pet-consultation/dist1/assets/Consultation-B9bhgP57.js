import{r as c,j as e,l as R,u as S,a as C,t as M}from"./index-BgTIe4Qm.js";import"./Button-CFZU5Yrt.js";import{P as B}from"./ProgressBar-DdTIvPjk.js";const E=({onRecordingComplete:x,maxDuration:r=300})=>{const[u,y]=c.useState(!1),[j,g]=c.useState(0),[k,f]=c.useState(null),[b,i]=c.useState(null),o=c.useRef(null),d=c.useRef(null),m=c.useRef([]),F=async()=>{try{const p=await navigator.mediaDevices.getUserMedia({audio:!0}),h=new MediaRecorder(p);o.current=h,m.current=[],h.ondataavailable=s=>{s.data.size>0&&m.current.push(s.data)},h.onstop=()=>{const s=new Blob(m.current,{type:"audio/wav"}),t=URL.createObjectURL(s);f(s),i(t);const l=new File([s],`voice-recording-${Date.now()}.wav`,{type:"audio/wav"});x&&x([l]),p.getTracks().forEach(n=>n.stop())},h.start(),y(!0),g(0),d.current=setInterval(()=>{g(s=>s>=r?(N(),s):s+1)},1e3)}catch(p){R.error("Microphone access failed",{error:p}),alert("دسترسی به میکروفون امکان‌پذیر نیست. لطفاً مجوز دسترسی را بدهید.")}},N=()=>{o.current&&u&&(o.current.stop(),y(!1),d.current&&clearInterval(d.current))},v=()=>{b&&URL.revokeObjectURL(b),f(null),i(null),g(0),x&&x([])},w=p=>{const h=Math.floor(p/60),s=p%60;return`${h}:${s.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"voice-recorder p-4 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700",children:"🎤 ضبط صدا (اختیاری)"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["حداکثر ",Math.floor(r/60)," دقیقه"]})]}),e.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"در صورت نیاز صدای خود را ضبط کنید"}),k?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white p-3 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-gray-600",children:["ضبط شده: ",w(j)]}),e.jsx("button",{type:"button",onClick:v,className:"text-red-500 hover:text-red-700 text-sm",children:"حذف"})]}),e.jsxs("audio",{controls:!0,className:"w-full",children:[e.jsx("source",{src:b,type:"audio/wav"}),"مرورگر شما از پخش صدا پشتیبانی نمی‌کند."]})]}),e.jsx("button",{type:"button",onClick:()=>{v()},className:"w-full px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-colors duration-200",children:"ضبط مجدد"})]}):e.jsx("div",{className:"text-center",children:u?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-red-600 font-medium",children:["در حال ضبط... ",w(j)]})]}),e.jsx("button",{type:"button",onClick:N,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-lg transition-colors duration-200",children:"توقف ضبط"})]}):e.jsxs("button",{type:"button",onClick:F,className:"inline-flex items-center px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-colors duration-200",children:[e.jsx("span",{className:"w-3 h-3 bg-white rounded-full mr-2"}),"شروع ضبط"]})})]})},D=()=>{const x=S(),{userData:r,selectedPet:u,saveConsultationData:y}=C(),[j,g]=c.useState(!1),[k]=c.useState(!1),[f,b]=c.useState({}),[i,o]=c.useState({description:"",medicalDocuments:[],videos:[],audioFiles:[]}),[d,m]=c.useState({});c.useEffect(()=>{const s=localStorage.getItem("consultationData");if(s)try{const l=JSON.parse(s);o({description:l.description||"",medicalDocuments:l.medicalDocuments||[],videos:l.videos||[],audioFiles:l.audioFiles||[]})}catch(l){R.error("Failed to load saved consultation data",{error:l})}localStorage.getItem("selectedConsultationType")||x("/dashboard")},[x]),c.useEffect(()=>{u||x("/pet-selection")},[u,x]);const F=s=>{const t=Array.from(s.target.files||[]),l=[],n=[];t.forEach(a=>{if(a.size>5*1024*1024){n.push(`فایل ${a.name} بیش از 5MB است`);return}if(!["image/jpeg","image/png","image/jpg","application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"].includes(a.type)){n.push(`نوع فایل ${a.name} پشتیبانی نمی‌شود`);return}l.push(a)}),n.length>0?m(a=>({...a,medicalDocuments:n})):m(a=>({...a,medicalDocuments:[]})),o(a=>({...a,medicalDocuments:l}))},N=s=>{var n;const t=((n=s.target.files)==null?void 0:n[0])||null,l=[];if(t){if(t.size>50*1024*1024){l.push("اندازه ویدیو نباید بیش از 50MB باشد"),m(a=>({...a,videos:l}));return}if(!t.type.startsWith("video/")){l.push("فقط فایل‌های ویدیویی مجاز هستند"),m(a=>({...a,videos:l}));return}m(a=>({...a,videos:[]}))}o(a=>({...a,videos:t?[t]:[]}))},v=s=>{const t=Array.from(s.target.files||[]),l=[],n=[];t.forEach(a=>{if(a.size>5*1024*1024){n.push(`فایل صوتی ${a.name} بیش از 5MB است`);return}if(!a.type.startsWith("audio/")){n.push(`فایل ${a.name} نوع صوتی نیست`);return}l.push(a)}),n.length>0?m(a=>({...a,audioFiles:n})):m(a=>({...a,audioFiles:[]})),o(a=>({...a,audioFiles:l}))},w=s=>{o(t=>({...t,audioFiles:[...t.audioFiles,...s]})),m(t=>({...t,audioFiles:[]}))},p=()=>{const s={};return(!i.description||i.description.trim().length<20)&&(s.description="توضیحات باید حداقل ۲۰ کاراکتر باشد"),b(s),Object.keys(s).length===0},h=async s=>{if(s.preventDefault(),!!p()){g(!0);try{const t={consultationType:i.consultationType,description:i.description,user:{fullName:r==null?void 0:r.fullName,mobile:r==null?void 0:r.mobile,nationalId:r==null?void 0:r.nationalId},pet:u||{}};y(t),x("/payment",{state:t})}catch(t){R.error("Consultation form submission error",{error:t});const l=M(t.message)||"خطا در ارسال اطلاعات مشاوره";b({submit:l})}finally{g(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-cyan-50 to-blue-50",children:[e.jsx("div",{className:"max-w-4xl mx-auto px-4 pt-8 mb-8",children:e.jsx(B,{currentStep:3,totalSteps:4,steps:["انتخاب پت","ثبت نام","مشاوره","پرداخت"]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 pb-8",children:[e.jsxs("div",{className:"bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-lg p-4 mb-6 text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"📋"}),e.jsx("span",{className:"text-lg font-semibold",children:"مشاوره تخصصی"})]}),e.jsx("div",{className:"text-2xl font-bold mt-2",children:"هزینه مشاوره: 280,000 تومان"})]}),e.jsxs("div",{className:"card-elevated rounded-2xl p-4 sm:p-6 lg:p-8 mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl lg:text-2xl font-bold text-gray-800 mb-3 sm:mb-4 text-center",children:"درخواست مشاوره تخصصی"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 text-center mb-4 sm:mb-6",children:"لطفاً اطلاعات مورد نیاز برای مشاوره را تکمیل کنید"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"حیوان خانگی"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"نوع:"}),e.jsx("span",{className:"font-medium",children:(u==null?void 0:u.name)||(r==null?void 0:r.petSpecies)||"نامشخص"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"نام:"}),e.jsx("span",{className:"font-medium",children:(r==null?void 0:r.petName)||"نامشخص"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"سن:"}),e.jsxs("span",{className:"font-medium",children:[(r==null?void 0:r.petAge)||"نامشخص"," سال"]})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"اطلاعات شما"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"نام:"}),e.jsx("span",{className:"font-medium",children:(r==null?void 0:r.fullName)||"نامشخص"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-600",children:"موبایل:"}),e.jsx("span",{className:"font-medium",children:(r==null?void 0:r.mobile)||"نامشخص"})]})]})]})]}),e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsxs("div",{className:"card-elevated rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{className:"block text-gray-700 font-semibold mb-3",children:["بیماری / عارضه حیوان خانگی ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("textarea",{value:i.description,onChange:s=>o(t=>({...t,description:s.target.value})),className:"w-full p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-cyan-500 focus:border-transparent resize-y min-h-[120px]",rows:4,placeholder:"لطفاً توضیحات و سوال خود را در خصوص حیوان خانگی تان به تفصیل بنویسید..."}),e.jsxs("div",{className:"flex justify-between items-center mt-2",children:[e.jsxs("span",{className:"text-sm text-gray-500",children:[i.description.length,"/1000"]}),e.jsx("span",{className:"text-sm text-red-500",children:"۲۰ کاراکتر حداقل مورد نیاز"})]}),f.description&&e.jsx("p",{className:"text-red-500 text-sm mt-2",children:f.description})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-3",children:"محیط صدا (اختیاری)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"در صورت داشتن فایل صوتی مرتبط با حیوان خانگی خود آن را آپلود کنید یا صدای خود را ضبط کنید"}),e.jsx(E,{onRecordingComplete:w,maxDuration:300}),e.jsxs("div",{className:"mt-4 border-2 border-dashed border-gray-300 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"w-8 h-8 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"})})}),e.jsx("p",{className:"text-gray-600 mb-2",children:"یا فایل صوتی خود را آپلود کنید"}),e.jsx("p",{className:"text-sm text-gray-500",children:"حداکثر اندازه فایل: 5MB"}),e.jsx("input",{type:"file",multiple:!0,accept:"audio/*",onChange:v,className:"hidden",id:"audio-upload"}),e.jsx("label",{htmlFor:"audio-upload",className:"inline-block mt-3 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors",children:"انتخاب فایل صوتی"})]}),i.audioFiles.length>0&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"فایل‌های صوتی انتخاب شده:"}),i.audioFiles.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.name}),e.jsx("button",{type:"button",onClick:()=>{const l=i.audioFiles.filter((n,a)=>a!==t);o(n=>({...n,audioFiles:l}))},className:"text-red-500 hover:text-red-700 text-sm",children:"حذف"})]},t))]}),d.audioFiles&&d.audioFiles.length>0&&e.jsx("div",{className:"mt-2 text-red-500 text-sm",children:d.audioFiles.map((s,t)=>e.jsx("p",{children:s},t))})]})]}),e.jsxs("div",{className:"card-elevated rounded-2xl p-6 shadow-lg",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-3",children:"اسناد پزشکی (اختیاری)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"در صورت وجود عکس آزمایش، درمان های قبلی، آزمایشگاه های ساده و پیشینه‌ای/پزشکی/دارویی آن را آپلود کنید"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})})}),e.jsx("p",{className:"text-gray-600 mb-2",children:"فایل های خود را آپلود کنید"}),e.jsx("p",{className:"text-sm text-gray-500",children:"حداکثر اندازه فایل: 5MB - فرمت‌های مجاز: JPG, PNG, PDF, DOC, DOCX"}),e.jsx("input",{type:"file",multiple:!0,accept:"image/*,.pdf,.doc,.docx",onChange:F,className:"hidden",id:"documents-upload"}),e.jsx("label",{htmlFor:"documents-upload",className:"inline-block mt-4 px-6 py-2 bg-gray-100 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors",children:"انتخاب فایل"})]}),i.medicalDocuments.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"اسناد پزشکی انتخاب شده:"}),i.medicalDocuments.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.name}),e.jsx("button",{type:"button",onClick:()=>{const l=i.medicalDocuments.filter((n,a)=>a!==t);o(n=>({...n,medicalDocuments:l}))},className:"text-red-500 hover:text-red-700 text-sm",children:"حذف"})]},t))]}),d.medicalDocuments&&d.medicalDocuments.length>0&&e.jsx("div",{className:"mt-2 text-red-500 text-sm",children:d.medicalDocuments.map((s,t)=>e.jsx("p",{children:s},t))})]}),e.jsxs("div",{className:"card-elevated rounded-2xl p-6 shadow-lg",children:[e.jsx("label",{className:"block text-gray-700 font-semibold mb-3",children:"ویدیو (اختیاری)"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"اگر امکانش را دارید ویدیویی از حیوان خانگی خود آنها را از طریق آپلود کنید"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx("svg",{className:"w-12 h-12 mx-auto",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})})}),e.jsx("p",{className:"text-gray-600 mb-2",children:"ویدیو خود را آپلود کنید"}),e.jsx("p",{className:"text-sm text-gray-500",children:"حداکثر اندازه فایل: 50MB - فرمت‌های ویدیویی"}),e.jsx("input",{type:"file",accept:"video/*",onChange:N,className:"hidden",id:"video-upload"}),e.jsx("label",{htmlFor:"video-upload",className:"inline-block mt-4 px-6 py-2 bg-gray-100 text-gray-700 rounded-lg cursor-pointer hover:bg-gray-200 transition-colors",children:"انتخاب فایل"})]}),i.videos.length>0&&e.jsxs("div",{className:"mt-4 space-y-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"ویدیو انتخاب شده:"}),i.videos.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"text-sm text-gray-600",children:s.name}),e.jsx("button",{type:"button",onClick:()=>{o(l=>({...l,videos:[]}))},className:"text-red-500 hover:text-red-700 text-sm",children:"حذف"})]},t))]}),d.videos&&d.videos.length>0&&e.jsx("div",{className:"mt-2 text-red-500 text-sm",children:d.videos.map((s,t)=>e.jsx("p",{children:s},t))})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold text-blue-800 mb-2 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"💡"}),"نکات مهم"]}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• هر چه توضیحات شما دقیق‌تر باشد، مشاوره بهتری دریافت خواهید کرد"}),e.jsx("li",{children:"• در صورت وجود عکس آزمایش، فیلم یا تصاویری، حتماً آپلود کنید"}),e.jsx("li",{children:"• تصاویر و ویدیوها به تشخیص بهتر مشکل کمک می‌کند"}),e.jsx("li",{children:"• مشاور در زمان تعیین شده با شما تماس خواهد گرفت"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-6",children:[e.jsx("button",{type:"button",onClick:()=>x(-1),className:"flex-1 py-3 px-6 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"بازگشت به داشبورد"}),e.jsx("button",{type:"submit",disabled:j,className:"flex-1 py-3 px-6 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-lg hover:from-cyan-600 hover:to-teal-600 transition-all disabled:opacity-50",children:j?"در حال ارسال...":"ادامه به پرداخت"})]})]})]}),k&&e.jsx("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-full shadow-lg",children:"اطلاعات شما ذخیره شد"})]})]})};export{D as default};
