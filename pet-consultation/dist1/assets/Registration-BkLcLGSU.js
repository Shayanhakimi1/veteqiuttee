import{j as e,u as G,a as q,b as R,r as h,l as u,t as N,c as T}from"./index-BgTIe4Qm.js";import{B as P}from"./Button-CFZU5Yrt.js";import{I as g}from"./InputField-y3Sg7NNn.js";import{P as V}from"./ProgressBar-DdTIvPjk.js";import{A as D}from"./Alert-COEKwUaA.js";const O=({isOpen:f,onClose:m})=>f?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-md w-full mx-4 relative",children:[e.jsx("button",{onClick:m,className:"absolute top-4 right-4 text-gray-500 hover:text-gray-700 text-2xl font-bold",children:"×"}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:e.jsxs("span",{className:"block",children:["با همراهی فروشگاه بزرگ ",e.jsx("span",{className:"text-blue-900",children:"کاژه"})]})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-xl text-orange-500 font-medium mb-2",children:"در جزیره زیبای کیش"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700",children:"کنارتان هستیم"})]}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-orange-50 p-4 rounded-lg mb-6",children:e.jsx("p",{className:"text-gray-700 text-sm",children:"ما افتخار داریم که با حمایت فروشگاه بزرگ کاژه در جزیره زیبای کیش، بهترین خدمات مشاوره دامپزشکی را به شما ارائه می‌دهیم."})}),e.jsx("button",{onClick:m,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors",children:"ادامه ثبت نام"})]})]})}):null,Z=()=>{const f=G(),{selectedPet:m}=q(),{register:A}=R(),[y,w]=h.useState(!1),[d,b]=h.useState({}),[B,v]=h.useState(!1),[t,F]=h.useState({fullName:"",petName:"",petBreed:"",petAge:"",petGender:"",isNeutered:!1,mobile:"",password:"",confirmPassword:""});h.useEffect(()=>{u.info("Registration page loaded with empty form")},[]);const S=()=>{if(!m)return"نژاد حیوان خانگی را وارد کنید";switch(m.name){case"سگ":return"نژاد حیوان خانگی را وارد کنید (مثال: ژرمن شپرد)";case"گربه":return"نژاد حیوان خانگی را وارد کنید (مثال: پرشین)";default:return"نژاد حیوان خانگی را وارد کنید (مثال: خرگوش)"}};h.useEffect(()=>{const c=setTimeout(()=>{v(!0)},5e3);return()=>clearTimeout(c)},[]);const k=(c,s)=>{const a={...d};switch(c){case"fullName":{const l=s?s.trim().split(" ").filter(r=>r.length>0):[];!s||s.length<3?a.fullName="نام و نام‌خانوادگی باید حداقل 3 کاراکتر باشد":l.length<2?a.fullName="لطفاً هم نام و هم نام‌خانوادگی را وارد کنید":delete a.fullName;break}case"petName":s.length<2?a.petName="نام حیوان خانگی باید حداقل 2 کاراکتر باشد":delete a.petName;break;case"petBreed":s.length<2?a.petBreed="نژاد حیوان خانگی باید حداقل 2 کاراکتر باشد":delete a.petBreed;break;case"petAge":s?delete a.petAge:a.petAge="لطفاً سن حیوان خانگی را وارد کنید";break;case"petGender":s?delete a.petGender:a.petGender="لطفاً جنسیت حیوان خانگی را انتخاب کنید";break;case"mobile":{const l="۰۱۲۳۴۵۶۷۸۹",r=s.replace(/[\u06F0-\u06F9]/g,o=>String(l.indexOf(o)));/^09[0-9]{9}$/.test(r)?delete a.mobile:a.mobile="شماره موبایل باید با 09 شروع شده و 11 رقم باشد";break}case"password":s.length<8?a.password="رمز عبور باید حداقل 8 کاراکتر باشد":/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).+$/.test(s)?delete a.password:a.password="رمز عبور باید شامل حروف کوچک و بزرگ انگلیسی و اعداد باشد",t.confirmPassword&&s!==t.confirmPassword?a.confirmPassword="تایید رمز عبور مطابقت ندارد":t.confirmPassword&&s===t.confirmPassword&&delete a.confirmPassword;break;case"confirmPassword":s!==t.password?a.confirmPassword="تایید رمز عبور مطابقت ندارد":delete a.confirmPassword;break}a.submit&&delete a.submit,b(a)},j=(c=>{let s=0;return c.length>=6&&(s+=25),c.length>=8&&(s+=25),/[A-Z]/.test(c)&&(s+=25),/[0-9]/.test(c)&&(s+=25),s})(t.password),x=c=>{const{name:s,value:a,type:l,checked:r}=c.target;let n=l==="checkbox"?r:a;if(s==="mobile"&&l!=="checkbox"){const o="۰۱۲۳۴۵۶۷۸۹";n=a.replace(/[\u06F0-\u06F9]/g,i=>String(o.indexOf(i)))}F(o=>({...o,[s]:n})),l!=="checkbox"&&k(s,n)},p=c=>{const{name:s,value:a}=c.target;k(s,a)},C=c=>{c.preventDefault(),u.info("Form submitted",{formData:t});const s={},a={fullName:"نام و نام‌خانوادگی",petName:"نام حیوان خانگی",petBreed:"نژاد حیوان خانگی",petAge:"سن حیوان خانگی",petGender:"جنسیت حیوان خانگی",mobile:"شماره موبایل",password:"رمز عبور",confirmPassword:"تایید رمز عبور"};if(Object.keys(a).forEach(l=>{(!t[l]||t[l].toString().trim()==="")&&(s[l]=`${a[l]} الزامی است`)}),t.fullName&&t.fullName.length<3?s.fullName="نام و نام‌خانوادگی باید حداقل 3 کاراکتر باشد":t.fullName&&t.fullName.trim().split(" ").filter(r=>r.length>0).length<2&&(s.fullName="لطفاً هم نام و هم نام‌خانوادگی را وارد کنید"),t.mobile){const l="۰۱۲۳۴۵۶۷۸۹",r=t.mobile.replace(/[\u06F0-\u06F9]/g,o=>String(l.indexOf(o)));/^09[0-9]{9}$/.test(r)||(s.mobile="شماره موبایل باید با 09 شروع شده و 11 رقم باشد")}if(t.password!==t.confirmPassword&&(s.confirmPassword="تایید رمز عبور مطابقت ندارد"),m||(s.petType="لطفاً نوع حیوان خانگی را انتخاب کنید"),u.warn("Form validation errors",{errors:s}),b(s),Object.keys(s).length>0){u.warn("Form submission blocked due to validation errors");return}u.info("Form validation passed, proceeding with registration"),w(!0),setTimeout(async()=>{var l;try{u.info("Starting registration process"),b(o=>({...o,submit:null}));const r={...t,petAge:t.petAge?parseInt(t.petAge,10):null,petType:(m==null?void 0:m.name)||"Unknown"};u.info("Sending registration data to server",{registrationData:r});const n=await A(r);u.info("Registration successful",{response:n}),w(!1),b({submit:null}),setTimeout(()=>{f("/dashboard")},1e3)}catch(r){u.error("Registration failed",{error:r,errorMessage:r.message,errorResponse:(l=r.response)==null?void 0:l.data}),w(!1);let n="خطا در ثبت‌نام. لطفاً دوباره تلاش کنید.";try{if(r.name==="TypeError"&&r.message.includes("fetch"))n="خطا در اتصال به سرور. لطفاً اتصال اینترنت خود را بررسی کنید.";else if(r.name==="AbortError")n="درخواست لغو شد. لطفاً دوباره تلاش کنید.";else if(r.response){const o=r.response.status,i=r.response.data;switch(o){case 400:i!=null&&i.message&&i.message.includes("Validation error:")?n=T(i.message):n=N(i==null?void 0:i.message)||"اطلاعات وارد شده معتبر نیست.";break;case 409:n=N(i==null?void 0:i.message)||"کاربری با این شماره موبایل قبلاً ثبت‌نام کرده است.";break;case 422:n=N(i==null?void 0:i.message)||"اطلاعات وارد شده ناقص یا نامعتبر است.";break;case 500:n="خطا در سرور. لطفاً بعداً تلاش کنید.";break;case 503:n="سرویس موقتاً در دسترس نیست. لطفاً بعداً تلاش کنید.";break;default:n=N(i==null?void 0:i.message)||`خطا در سرور (کد: ${o})`}}else r.message&&(n=N(r.message),r.message.includes("قبلاً در سیستم ثبت‌نام کرده است")||r.message.includes("کاربری با این شماره موبایل قبلاً ثبت‌نام کرده است")||r.message.includes("User already exists")||r.message.includes("duplicate"))}catch(o){u.error("Error parsing registration error",{parseError:o}),n="خطای غیرمنتظره رخ داد. لطفاً دوباره تلاش کنید."}b(o=>({...o,submit:n}))}},1500)},E=()=>{const s=["fullName","petName","petBreed","petAge","petGender","mobile","password","confirmPassword"].every(l=>{const r=t[l];return typeof r=="string"?r.trim()!=="":r!=null}),a=Object.keys(d).some(l=>{if(l==="submit")return!1;const r=t[l];return(typeof r=="string"?r.trim()!=="":r!=null)&&d[l]});return s&&!a};return e.jsxs("div",{className:"min-h-screen gradient-bg",children:[e.jsx("div",{className:"bg-white shadow-sm",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:e.jsx(V,{currentStep:2,totalSteps:4})})}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 py-8",children:[m&&e.jsx("div",{className:"bg-cyan-50 border border-cyan-200 rounded-xl p-4 mb-8",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:m.emoji}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-cyan-600 font-medium",children:"حیوان خانگی انتخابی:"}),e.jsx("p",{className:"text-cyan-800 font-bold",children:m.name})]})]})}),e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"ثبت نام در سیستم"}),e.jsx("p",{className:"text-gray-600",children:"لطفاً اطلاعات خود و حیوان خانگی‌تان را وارد کنید"})]}),e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"اطلاعات شخصی"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"نام و نام‌خانوادگی",name:"fullName",value:t.fullName,onChange:x,onBlur:p,placeholder:"نام و نام‌خانوادگی خود را وارد کنید",error:d.fullName,required:!0}),e.jsx(g,{label:"شماره موبایل",name:"mobile",type:"tel",value:t.mobile,onChange:x,onBlur:p,placeholder:"09xxxxxxxxx",error:d.mobile,required:!0,className:"ltr text-left",maxLength:11})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"اطلاعات حیوان خانگی"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{label:"نام حیوان خانگی",name:"petName",value:t.petName,onChange:x,onBlur:p,placeholder:"نام حیوان خانگی خود را وارد کنید",error:d.petName,required:!0}),e.jsx(g,{label:"نژاد حیوان خانگی",name:"petBreed",value:t.petBreed,onChange:x,onBlur:p,placeholder:S(),error:d.petBreed,required:!0}),e.jsx(g,{label:"سن حیوان خانگی",name:"petAge",value:t.petAge,onChange:x,onBlur:p,placeholder:"سن حیوان خانگی را وارد کنید (مثال: 2 سال، 6 ماه)",error:d.petAge,required:!0}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["جنسیت حیوان خانگی ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"petGender",value:"نر",checked:t.petGender==="نر",onChange:x,className:"ml-2 text-cyan-600 focus:ring-cyan-500"}),"نر"]}),e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"radio",name:"petGender",value:"ماده",checked:t.petGender==="ماده",onChange:x,className:"ml-2 text-cyan-600 focus:ring-cyan-500"}),"ماده"]})]}),d.petGender&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:d.petGender})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"isNeutered",checked:t.isNeutered,onChange:x,className:"ml-2 text-cyan-600 focus:ring-cyan-500 rounded"}),e.jsx("span",{className:"text-sm font-medium text-gray-700",children:"عقیم شده است"})]})})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:"رمز عبور"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(g,{label:"رمز عبور",name:"password",type:"password",value:t.password,onChange:x,onBlur:p,placeholder:"رمز عبور خود را وارد کنید",error:d.password,required:!0,showPasswordToggle:!0}),t.password&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-600 mb-1",children:[e.jsx("span",{children:"قدرت رمز عبور:"}),e.jsxs("span",{children:[j,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${j<50?"bg-red-500":j<75?"bg-yellow-500":"bg-green-500"}`,style:{width:`${j}%`}})})]})]}),e.jsx(g,{label:"تایید رمز عبور",name:"confirmPassword",type:"password",value:t.confirmPassword,onChange:x,onBlur:p,placeholder:"رمز عبور را مجدداً وارد کنید",error:d.confirmPassword,required:!0,showPasswordToggle:!0})]})]}),d.submit&&e.jsx(D,{type:"error",message:d.submit,className:"mb-4"}),e.jsxs("div",{className:"text-center pt-4",children:[e.jsx(P,{type:"submit",loading:y,disabled:!E(),size:"lg",className:"min-w-48",children:"ثبت نام"}),e.jsx("div",{className:"mt-4",children:e.jsx(P,{variant:"outline",onClick:()=>f("/pet-selection"),disabled:y,children:"بازگشت"})}),e.jsxs("p",{className:"text-sm text-gray-500 mt-4",children:["با ثبت نام، شما با",e.jsx("a",{href:"#",className:"text-cyan-600 hover:underline",children:"قوانین و مقررات"})," ","موافقت می‌کنید"]})]})]}),e.jsx("div",{className:"text-center mt-8",children:e.jsxs("p",{className:"text-gray-600",children:["قبلاً ثبت نام کرده‌اید؟"," ",e.jsx("button",{onClick:()=>f("/login"),className:"text-cyan-600 hover:underline font-medium",children:"وارد شوید"})]})})]}),e.jsx(O,{isOpen:B,onClose:()=>v(!1)})]})};export{Z as default};
